<!DOCTYPE html>
<html>

<head>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js" defer></script>
    <title>Ordens de Atendimento</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="logo">
            <img src="/img/logo.png" alt="Seu Logo">
        </div>
        <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
    </header>
    <div class="sidebar" id="mySidebar">
        <a href="#" onclick="closeMenu()"><span class="menu-icon close-icon">&#9776;</span></a>
        <a href="ordens.html">Ordens de Serviço</a>
        <a href="busca.html">Consultar</a>
        <a href="cadastro.html">Criar atendimento</a>
    </div>

    <script>
        function toggleMenu() {
            var sidebar = document.getElementById("mySidebar");
            sidebar.classList.toggle("active");
        }

        function closeMenu() {
            var sidebar = document.getElementById("mySidebar");
            sidebar.classList.remove("active");
        }
    </script>

    <div class="meio">
        <h1>Ordens de Atendimento</h1>
        <div id="resultados"></div>
    </div>
    <script type="module">
        const resultadosDiv = document.getElementById('resultados');

        function buscarAtendimentos() {
            resultadosDiv.innerHTML = ""; // Limpa resultados anteriores

            db.collection("atendimentos")
                .orderBy("id", "desc")
                .limit(10)
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        resultadosDiv.innerHTML = "<p>Nenhuma ordem encontrada.</p>";
                        return;
                    }

                    querySnapshot.forEach((doc) => {
                        const atendimento = doc.data();
                        const resultadoItem = document.createElement('div');
                        resultadoItem.classList.add('resultado-item');
                        resultadoItem.innerHTML = `
                  <p><strong>ID:</strong> ${atendimento.id}</p> <p><strong>Nome:</strong> ${atendimento.nome}</p>
                  <p><strong>Data:</strong> ${atendimento.data}</p>
                  <p><strong>Problema:</strong> ${atendimento.problema}</p>
                  <p><strong>Solução:</strong> ${atendimento.solucao || "Não informada"}</p>
                  <p><strong>Observações:</strong> ${atendimento.observacoes || "Não informadas"}</p>
                `;
                        resultadoItem.addEventListener('click', () => {
                            window.location.href = `detalhes.html?id=${doc.id}`;
                        });
                        resultadosDiv.appendChild(resultadoItem);
                    });
                })
                .catch((error) => {
                    console.error("Erro ao buscar ordens: ", error);
                    resultadosDiv.innerHTML = "<p>Erro ao buscar ordens. Consulte o console.</p>";
                });
        }

        // Chama a função buscarAtendimentos() quando a página carrega
        window.addEventListener('load', buscarAtendimentos);
    </script>

</body>

</html>