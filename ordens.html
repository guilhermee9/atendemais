<!DOCTYPE html>
<html>

<head>
    <title>Ordens de Atendimento</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js" defer></script>

</head>

<body>
    <header>
        <div class="logo">
            <img src="/img/logo.png" alt="Seu Logo">
        </div>
        <div class="menu-icon" onclick="toggleMenu()">&#9776;</div>
    </header>
    <div class="sidebar" id="mySidebar">
        <a href="#" onclick="closeMenu()"><span class="menu-icon close-icon">&#9776;</span></a>
        <a href="#">Ordens de Serviço</a>
        <a href="busca.html">Consultar</a>
        <a href="cadastro.html">Cadastrar Usuário</a>
    </div>
    <div class="meio">
        <h1 style="text-align: center;">Buscar Atendimentos</h1>
        <input type="text" id="buscaNome" placeholder="Buscar por nome" maxlength="50">
        <input type="date" id="buscaData">
        <button onclick="buscarAtendimentos()">Buscar</button>
        <br>

        <h1>Ordens de Atendimento</h1>
        <div id="ordens-lista"></div>
    </div>

    <script>
        const ordensLista = document.getElementById('ordens-lista');

        db.collection("atendimentos")
            .orderBy("data") // Ordena pela data (do mais antigo para o mais novo)
            .get()
            .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const ordem = doc.data();
                    const ordemItem = document.createElement('div');
                    ordemItem.classList.add('ordem-item');
                    ordemItem.innerHTML = `
                        <p><strong>Nome:</strong> ${ordem.nome}</p>
                        <p><strong>Data:</strong> ${ordem.data}</p>
                    `;
                    ordemItem.addEventListener('click', () => {
                        // Redireciona para a página de detalhes, passando o ID do documento
                        window.location.href = `detalhes.html?id=${doc.id}`;
                    });
                    ordensLista.appendChild(ordemItem);
                });
            })
            .catch((error) => {
                console.error("Erro ao buscar ordens: ", error);
                ordensLista.innerHTML = "<p>Erro ao buscar ordens. Consulte o console.</p>";
            });
    </script>
</body>

</html>